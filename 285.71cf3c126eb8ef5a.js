"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[285],{9285:(H,Y,n)=>{n.r(Y),n.d(Y,{default:()=>O});var m=n(6223),x=n(2296),p=n(8034),u=n(4170),C=n(617),S=n(1476),c=n(5313),f=n(553),M=n(3519),y=n.n(M),A=n(8645),h=n(9773),U=n(5940),g=n(1474),N=n(6676),b=n.n(N),w=n(2596),t=n(9212),R=n(5619),F=n(9397);let Z=(()=>{class e{constructor(){this.url=f.N.url,this.limit=f.N.pagination,this._statistics=new R.X(null),this._httpCliente=(0,t.f3M)(g.eN)}get statistics$(){return this._statistics.asObservable()}getStatistics(i){return this._httpCliente.get(`${this.url}statistics`,{params:i}).pipe((0,F.b)(s=>{this._statistics.next(s)}))}getFileStatisticsUser(i){return this._httpCliente.get(`${this.url}statistics/user`,{params:i,responseType:"blob"})}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var I=n(5407);function E(e,l){1&e&&(t.TgZ(0,"th",25),t._uU(1," Nombre "),t.qZA())}function $(e,l){if(1&e&&(t.TgZ(0,"td",26),t._uU(1),t.qZA()),2&e){const i=l.$implicit;t.xp6(),t.hij(" ",i.usuarionombre," ")}}function j(e,l){1&e&&(t.TgZ(0,"th",25),t._uU(1," Minutos calidad "),t.qZA())}function Q(e,l){if(1&e&&(t.TgZ(0,"td",26),t._uU(1),t.qZA()),2&e){const i=l.$implicit;t.xp6(),t.hij(" ",i.totaltranscripciones,"")}}function L(e,l){1&e&&(t.TgZ(0,"th",25),t._uU(1," Acciones "),t.qZA())}function B(e,l){if(1&e){const i=t.EpF();t.TgZ(0,"td",26)(1,"button",27),t.NdJ("click",function(){const r=t.CHM(i).$implicit,o=t.oxw();return t.KtG(o.descargarTranscripcipnes(r))}),t.TgZ(2,"mat-icon"),t._uU(3,"visibility"),t.qZA()()()}}function J(e,l){1&e&&t._UZ(0,"tr",28)}function P(e,l){1&e&&t._UZ(0,"tr",29)}function z(e,l){1&e&&(t.TgZ(0,"div",30)(1,"p",31),t._uU(2,"No hay estadisticas para mostrar"),t.qZA()())}const O=[{path:"",component:(()=>{class e{constructor(i,s){this._statisticsService=i,this._changeDetectorRef=s,this._unsubscribeAll=new A.x,this.range=new m.cw({start:new m.NI(b()()),end:new m.NI(b()())}),this.statistics=[],this.totalStatistics=0,this.page=0,this.limit=f.N.pagination,this.loading=!1,this.displayedColumns=["nombre","transcripciones","acciones"],this.dataSource=new c.by([]),this.Toast=y().mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:a=>{a.addEventListener("mouseenter",y().stopTimer),a.addEventListener("mouseleave",y().resumeTimer)}})}ngOnInit(){this._statisticsService.statistics$.pipe((0,h.R)(this._unsubscribeAll)).subscribe(i=>{this.statistics=i.usuarios,this.totalStatistics=i.total,this.dataSource=new c.by(this.statistics),this.loading=!1,this._changeDetectorRef.markForCheck()}),this.range.valueChanges.pipe((0,h.R)(this._unsubscribeAll)).subscribe(i=>{i.start&&i.end&&(i.start.isAfter(i.end)?(this.Toast.fire({icon:"error",title:"La fecha de inicio no puede ser mayor a la fecha de fin"}),this.range.get("start")?.setValue(null),this.range.get("end")?.setValue(null)):(this.paginator.pageIndex=0,this.handlePageEvent({pageIndex:0,pageSize:this.limit,length:this.totalStatistics})))})}descargarTranscripcipnes(i){let s=new g.LE;s=s.append("user_id",i.usuarioid),s=s.append("fechaInicio",this.convertDateToYYYYMMDD(this.range.get("start")?.value)),s=s.append("fechaFin",this.convertDateToYYYYMMDD(this.range.get("end")?.value)),this._statisticsService.getFileStatisticsUser(s).pipe((0,h.R)(this._unsubscribeAll)).subscribe({next:a=>{const r=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=window.URL.createObjectURL(r),v=document.createElement("a");v.href=o,v.download=`${i.usuarionombre}-transcripciones.xlsx`,v.click(),window.URL.revokeObjectURL(o),this.Toast.fire({icon:"success",title:"Transcripciones descargadas correctamente"})},error:a=>{this.Toast.fire({icon:"error",title:"Error al descargar las transcripciones"})}})}handlePageEvent(i){this.loading=!0;const s=i.pageIndex+1,a=this.range.get("start")?.value,r=this.range.get("end")?.value;let o=new g.LE;o=o.append("page",s.toString()),o=o.append("limit",this.limit.toString()),a&&(o=o.append("fechaInicio",this.convertDateToYYYYMMDD(a))),r&&(o=o.append("fechaFin",this.convertDateToYYYYMMDD(r))),this._statisticsService.getStatistics(o).pipe((0,h.R)(this._unsubscribeAll)).subscribe()}convertDateToYYYYMMDD(i){return i.format("YYYY-MM-DD")}static#t=this.\u0275fac=function(s){return new(s||e)(t.Y36(Z),t.Y36(t.sBO))};static#e=this.\u0275cmp=t.Xpm({type:e,selectors:[["app-statistics"]],viewQuery:function(s,a){if(1&s&&t.Gf(S.NW,7),2&s){let r;t.iGM(r=t.CRH())&&(a.paginator=r.first)}},standalone:!0,features:[t.jDz],decls:35,vars:10,consts:[["cdkScrollable","",1,"absolute","inset-0","flex","flex-col","min-w-0","overflow-y-auto","bg-white"],[1,"flex-auto","p-6","sm:px-26","sm:py-10"],[1,"min-h-100"],[1,"flex","flex-col","sm:flex-row","sm:justify-between","sm:items-center","items-start","mb-6","w-full"],[1,"text-4xl","font-semibold","text-primary-700"],[1,"w-full","md:w-1/3"],["appearance","fill",1,"w-full","mb-4"],[3,"formGroup","rangePicker"],["matStartDate","","formControlName","start","placeholder","Start date","readonly",""],["matEndDate","","formControlName","end","placeholder","End date","readonly",""],["matIconSuffix","",3,"for"],["picker",""],[1,"overflow-x-auto"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","nombre"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","transcripciones"],["matColumnDef","acciones"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","flex justify-center items-center w-full h-64"],[1,"w-full","flex","justify-end"],["aria-label","Seleccionar pagina de estadisticas","showFirstLastButtons","true",3,"length","pageSize","disabled","page"],["paginator",""],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","color","primary","matTooltip","Descargar transcripciones usuario",3,"click"],["mat-header-row",""],["mat-row",""],[1,"flex","justify-center","items-center","w-full","h-64"],[1,"text-gray-500"]],template:function(s,a){if(1&s&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),t._uU(5,"Consolidado minutos"),t.qZA()(),t.TgZ(6,"div",5)(7,"mat-form-field",6)(8,"mat-label"),t._uU(9,"Ingresa una fecha de busqueda"),t.qZA(),t.TgZ(10,"mat-date-range-input",7),t._UZ(11,"input",8)(12,"input",9),t.qZA(),t.TgZ(13,"mat-hint"),t._uU(14,"MM/DD/YYYY \u2013 MM/DD/YYYY"),t.qZA(),t._UZ(15,"mat-datepicker-toggle",10)(16,"mat-date-range-picker",null,11),t.qZA()(),t.TgZ(18,"div",12)(19,"table",13),t.ynx(20,14),t.YNc(21,E,2,0,"th",15)(22,$,2,1,"td",16),t.BQk(),t.ynx(23,17),t.YNc(24,j,2,0,"th",15)(25,Q,2,1,"td",16),t.BQk(),t.ynx(26,18),t.YNc(27,L,2,0,"th",15)(28,B,4,0,"td",16),t.BQk(),t.YNc(29,J,1,0,"tr",19)(30,P,1,0,"tr",20),t.qZA()(),t.YNc(31,z,3,0,"div",21),t.TgZ(32,"div",22)(33,"mat-paginator",23,24),t.NdJ("page",function(o){return a.handlePageEvent(o)}),t.qZA()()()()()),2&s){const r=t.MAs(17);t.xp6(10),t.Q6J("formGroup",a.range)("rangePicker",r),t.xp6(5),t.Q6J("for",r),t.xp6(4),t.Q6J("dataSource",a.dataSource),t.xp6(10),t.Q6J("matHeaderRowDef",a.displayedColumns),t.xp6(),t.Q6J("matRowDefColumns",a.displayedColumns),t.xp6(),t.um2(31,0===a.totalStatistics?31:-1),t.xp6(2),t.Q6J("length",a.totalStatistics)("pageSize",a.limit)("disabled",a.loading)}},dependencies:[c.p0,c.BZ,c.fO,c.as,c.w1,c.Dz,c.nj,c.ge,c.ev,c.XQ,c.Gk,C.Ps,C.Hw,x.ot,x.RK,p.FA,I.PQ,p.nW,p.wx,p.zY,p.By,p._g,m.u5,m.Fj,m.JJ,m.JL,m.UX,m.sg,m.u,S.TU,S.NW,u.lN,u.KE,u.hX,u.bx,u.R9,U.Cq,w.AV,w.gM],encapsulation:2,changeDetection:0})}return e})(),resolve:{statistics:(e,l)=>{const i=e.queryParams.page||1,s=f.N.pagination;let a=e.queryParams.fechaInicio||null,r=e.queryParams.fechaFin||null;if(!a){const d=new Date,D=String(d.getDate()).padStart(2,"0"),T=String(d.getMonth()+1).padStart(2,"0");a=`${d.getFullYear()}-${T}-${D}`}if(!r){const d=new Date,D=String(d.getDate()).padStart(2,"0"),T=String(d.getMonth()+1).padStart(2,"0");r=`${d.getFullYear()}-${T}-${D}`}const o=(new g.LE).set("page",i).set("limit",s).set("fechaInicio",a).set("fechaFin",r);return(0,t.f3M)(Z).getStatistics(o)}}}]}}]);