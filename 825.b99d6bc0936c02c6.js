"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[825],{5825:(ut,C,s)=>{s.r(C),s.d(C,{default:()=>lt});var b=s(6814),p=s(2296),U=s(617),u=s(5313),T=s(1476),Z=s(8645),g=s(9773),v=s(553),A=s(2596),D=s(3519),f=s.n(D),n=s(6223),d=s(7700),y=s(8525),w=s(4516),h=s(4170),R=s(4205),t=s(9212),x=s(1474),N=s(5619),F=s(9397);let _=(()=>{class e{constructor(){this.url=v.N.url,this.limit=v.N.pagination,this._httpCliente=(0,t.f3M)(x.eN),this._usuarios=new N.X(null)}set usuarios(o){this._usuarios.next(o)}get usuarios$(){return this._usuarios.asObservable()}getAllUsuarios(o){let i=new x.LE;return i=i.append("page",o),i=i.append("limit",this.limit),this._httpCliente.get(`${this.url}usuarios/all`,{params:i}).pipe((0,F.b)(r=>{this._usuarios.next(r)}))}getUsuariosPaginated(o){let i=new x.LE;return i=i.append("page",o),i=i.append("limit",this.limit),this._httpCliente.get(`${this.url}usuarios/all`,{params:i})}createUsuario(o){return this._httpCliente.post(`${this.url}usuarios`,o)}updateUsuario(o,i){return this._httpCliente.patch(`${this.url}usuarios/${i}`,o)}setActiveUsuario(o){return this._httpCliente.patch(`${this.url}usuarios/setActive/${o}`,{})}static#t=this.\u0275fac=function(i){return new(i||e)};static#e=this.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var k=s(3680);function Y(e,a){1&e&&(t.TgZ(0,"mat-error"),t._uU(1," El correo es requerido. "),t.qZA())}function q(e,a){1&e&&(t.TgZ(0,"mat-error"),t._uU(1," Ingresa un correo electronico valido. "),t.qZA())}function S(e,a){1&e&&(t.TgZ(0,"mat-option",11),t._uU(1," Supervisor "),t.qZA()),2&e&&t.Q6J("value","supervisor")}function E(e,a){1&e&&t._UZ(0,"mat-icon",19),2&e&&t.Q6J("svgIcon","heroicons_solid:eye")}function M(e,a){1&e&&t._UZ(0,"mat-icon",19),2&e&&t.Q6J("svgIcon","heroicons_solid:eye-slash")}function P(e,a){1&e&&(t.TgZ(0,"mat-error"),t._uU(1," La contrase\xf1a es requerida "),t.qZA())}function B(e,a){1&e&&(t.TgZ(0,"mat-error"),t._uU(1," La contrase\xf1a debe tener al menos 6 caracteres "),t.qZA())}const $=()=>["admin"];let I=(()=>{class e{constructor(o,i,r,l,c){this.data=o,this.dialogRef=i,this._formBuilder=r,this._changeDetectorRef=l,this._usuariosService=c,this._unsubscribeAll=new Z.x,this.title="",this.showData=!1,this.usuario={},this.Toast=f().mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:m=>{m.addEventListener("mouseenter",f().stopTimer),m.addEventListener("mouseleave",f().resumeTimer)}})}ngOnInit(){if(this.title=this.data.title,this.usuarioForm=this._formBuilder.group({nombre:["",n.kI.required],correo:["",n.kI.compose([n.kI.required,n.kI.email])],rol:["",n.kI.required],password:["",n.kI.compose([n.kI.minLength(6)])]}),"edit"===this.data.action){this.usuario=this.data.usuario;const o=this.data.usuario;this.usuarioForm.patchValue({nombre:o.nombre,correo:o.email,rol:o.rol,password:"",passwordConfirm:""})}}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}cerrarDialogo(){this.dialogRef.close("cancelar")}guardarUsuario(){if(!this.usuarioForm.valid)return void this.Toast.fire({icon:"error",title:"Debes completar todos los campos."});this.usuarioForm.disable();const o=this.usuarioForm.value;let i={email:o.correo,nombre:o.nombre,rol:o.rol,password:o.password};""===o.password&&delete i.password,"create"===this.data.action?this.crearUsuario(i):this.editarUsuario(i)}crearUsuario(o){this._usuariosService.createUsuario(o).pipe((0,g.R)(this._unsubscribeAll)).subscribe(i=>{i.ok?(this.Toast.fire({icon:"success",title:i.message}),this.dialogRef.close("exito")):(this.Toast.fire({icon:"error",title:i.message}),this.usuarioForm.enable())},i=>{this.Toast.fire({icon:"error",title:i.error.message}),this.usuarioForm.enable()})}editarUsuario(o){this._usuariosService.updateUsuario(o,this.usuario.id).pipe((0,g.R)(this._unsubscribeAll)).subscribe(i=>{i.ok?(this.Toast.fire({icon:"success",title:i.message}),this.dialogRef.close("exito")):(this.Toast.fire({icon:"error",title:i.message}),this.usuarioForm.enable())},i=>{this.Toast.fire({icon:"error",title:i.error.message}),this.usuarioForm.enable()})}static#t=this.\u0275fac=function(i){return new(i||e)(t.Y36(d.WI),t.Y36(d.so),t.Y36(n.qu),t.Y36(t.sBO),t.Y36(_))};static#e=this.\u0275cmp=t.Xpm({type:e,selectors:[["app-usuarios-modal"]],standalone:!0,features:[t.jDz],decls:46,vars:20,consts:[["mat-dialog-title","",1,"flex","text-primary-600","font-bold","text-3xl"],[1,"w-full"],["autocomplete","false",3,"formGroup"],[1,"mb-4"],["id","nombre","type","text","matInput","","required","",3,"formControlName"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["id","field-1","name","field-1","type","email","matInput","","required","","autocomplete","one-time-code","role","presentation",3,"formControlName"],[4,"ngIf"],["required","",3,"formControlName"],["disabled","",3,"value"],[3,"value",4,"appShowForRoles"],[3,"value"],["id","field-2","name","field-2","matInput","","type","password","autocomplete","one-time-code","role","presentation",3,"formControlName"],["passwordField",""],["mat-icon-button","","type","button","matSuffix","",3,"click"],["class","icon-size-5",3,"svgIcon",4,"ngIf"],[1,"flex","justify-between","mt-4"],["mat-button","",1,"text-black","hover:bg-black","hover:text-white","border-2","rounded-md","border-solid",3,"click"],["mat-flat-button","",1,"text-white","hover:bg-white","hover:text-primary-600","border-2","rounded-md","hover:border-solid",3,"color","click"],[1,"icon-size-5",3,"svgIcon"]],template:function(i,r){if(1&i){const l=t.EpF();t.TgZ(0,"h2",0),t._uU(1),t.qZA(),t.TgZ(2,"mat-dialog-content")(3,"div",1)(4,"form",2)(5,"div",3)(6,"mat-form-field",1)(7,"mat-label"),t._uU(8,"Nombre"),t.qZA(),t._UZ(9,"input",4)(10,"mat-icon",5),t.qZA()(),t.TgZ(11,"div",3)(12,"mat-form-field",1)(13,"mat-label"),t._uU(14,"Correo electronico"),t.qZA(),t._UZ(15,"input",6)(16,"mat-icon",5),t.YNc(17,Y,2,0,"mat-error",7)(18,q,2,0,"mat-error",7),t.qZA()(),t.TgZ(19,"div",3)(20,"mat-form-field",1)(21,"mat-label"),t._uU(22,"Rol"),t.qZA(),t.TgZ(23,"mat-select",8)(24,"mat-option",9),t._uU(25," Seleccionar Rol "),t.qZA(),t.YNc(26,S,2,1,"mat-option",10),t.TgZ(27,"mat-option",11),t._uU(28," Auditor "),t.qZA()(),t._UZ(29,"mat-icon",5),t.qZA()(),t.TgZ(30,"div",3)(31,"mat-form-field",1)(32,"mat-label"),t._uU(33,"Contrase\xf1a"),t.qZA(),t._UZ(34,"input",12,13),t.TgZ(36,"button",14),t.NdJ("click",function(){t.CHM(l);const m=t.MAs(35);return t.KtG(m.type="password"===m.type?"text":"password")}),t.YNc(37,E,1,1,"mat-icon",15)(38,M,1,1,"mat-icon",15),t.qZA(),t.YNc(39,P,2,0,"mat-error",7)(40,B,2,0,"mat-error",7),t.qZA()()()()(),t.TgZ(41,"mat-dialog-actions",16)(42,"button",17),t.NdJ("click",function(){return r.cerrarDialogo()}),t._uU(43,"Cancelar"),t.qZA(),t.TgZ(44,"button",18),t.NdJ("click",function(){return r.guardarUsuario()}),t._uU(45,"Guardar"),t.qZA()()}if(2&i){const l=t.MAs(35);t.xp6(),t.Oqu(r.title),t.xp6(3),t.Q6J("formGroup",r.usuarioForm),t.xp6(5),t.Q6J("formControlName","nombre"),t.xp6(),t.Q6J("svgIcon","mat_outline:person_outline"),t.xp6(5),t.Q6J("formControlName","correo"),t.xp6(),t.Q6J("svgIcon","mat_outline:person_outline"),t.xp6(),t.Q6J("ngIf",r.usuarioForm.get("correo").hasError("required")),t.xp6(),t.Q6J("ngIf",r.usuarioForm.get("correo").hasError("email")),t.xp6(5),t.Q6J("formControlName","rol"),t.xp6(),t.Q6J("value",""),t.xp6(2),t.Q6J("appShowForRoles",t.DdM(19,$)),t.xp6(),t.Q6J("value","auditor"),t.xp6(2),t.Q6J("svgIcon","heroicons_solid:users"),t.xp6(5),t.Q6J("formControlName","password"),t.xp6(3),t.Q6J("ngIf","password"===l.type),t.xp6(),t.Q6J("ngIf","text"===l.type),t.xp6(),t.Q6J("ngIf",r.usuarioForm.get("password").hasError("required")),t.xp6(),t.Q6J("ngIf",r.usuarioForm.get("password").hasError("minlength")),t.xp6(4),t.Q6J("color","primary")}},dependencies:[b.ez,b.O5,d.Is,d.uh,d.H8,d.xY,p.ot,p.lW,p.RK,U.Ps,U.Hw,n.u5,n._Y,n.Fj,n.JJ,n.JL,n.Q7,h.lN,h.KE,h.hX,h.TO,h.qo,h.R9,n.UX,n.sg,n.u,w.c,w.Nt,y.LD,y.gD,k.ey,R.Y],encapsulation:2})}return e})();var O=s(6593),J=s(8109),j=s(5407);function z(e,a){1&e&&(t.TgZ(0,"th",21),t._uU(1," Id "),t.qZA())}function L(e,a){if(1&e&&(t.TgZ(0,"td",22),t._uU(1),t.qZA()),2&e){const o=a.$implicit;t.xp6(),t.hij(" ",o.id," ")}}function H(e,a){1&e&&(t.TgZ(0,"th",21),t._uU(1," Nombre "),t.qZA())}function G(e,a){if(1&e&&(t.TgZ(0,"td",22),t._uU(1),t.qZA()),2&e){const o=a.$implicit;t.xp6(),t.hij(" ",o.nombre,"")}}function K(e,a){1&e&&(t.TgZ(0,"th",21),t._uU(1," Correo "),t.qZA())}function X(e,a){if(1&e&&(t.TgZ(0,"td",22),t._uU(1),t.qZA()),2&e){const o=a.$implicit;t.xp6(),t.hij(" ",o.email," ")}}function W(e,a){1&e&&(t.TgZ(0,"th",21),t._uU(1," Rol "),t.qZA())}function V(e,a){if(1&e&&(t.TgZ(0,"td",22),t._uU(1),t.qZA()),2&e){const o=a.$implicit;t.xp6(),t.hij(" ",o.rol," ")}}function tt(e,a){1&e&&(t.TgZ(0,"th",21),t._uU(1," Online "),t.qZA())}function et(e,a){1&e&&t._UZ(0,"span",25)}function ot(e,a){1&e&&t._UZ(0,"span",26)}function it(e,a){if(1&e&&(t.TgZ(0,"td",22),t.YNc(1,et,1,0,"span",23)(2,ot,1,0,"span",24),t.qZA()),2&e){const o=a.$implicit;t.xp6(),t.Q6J("ngIf",o.login_status),t.xp6(),t.Q6J("ngIf",!o.login_status)}}function rt(e,a){1&e&&t._UZ(0,"th",21)}function at(e,a){if(1&e){const o=t.EpF();t.TgZ(0,"td",22)(1,"label",27)(2,"input",28),t.NdJ("change",function(){const l=t.CHM(o).$implicit,c=t.oxw();return t.KtG(c.setUsuarioActive(l.id))}),t.qZA(),t._UZ(3,"div",29),t.qZA(),t.TgZ(4,"button",30),t.NdJ("click",function(){const l=t.CHM(o).$implicit,c=t.oxw();return t.KtG(c.abrirDialogoEditarUsuario(l))}),t._UZ(5,"mat-icon",6),t.qZA()()}if(2&e){const o=a.$implicit;t.xp6(),t.s9C("matTooltip",o.is_active?"Usuario Activo":"Usuario inactivo"),t.xp6(),t.Q6J("checked",o.is_active),t.xp6(3),t.Q6J("svgIcon","heroicons_outline:pencil")}}function st(e,a){1&e&&t._UZ(0,"tr",31)}function nt(e,a){1&e&&t._UZ(0,"tr",32)}const lt=[{path:"",component:(()=>{class e{constructor(o,i,r,l,c,m){this.titleService=o,this.dialog=i,this._changeDetectorRef=r,this._usuariosService=l,this.router=c,this.activatedRoute=m,this._unsubscribeAll=new Z.x,this.displayedColumns=["id","nombre","rol","correo","online","acciones"],this.dataSource=new u.by([]),this.totalUsuarios=0,this.page=0,this.limit=v.N.pagination,this.loading=!1,this.titleService.setTitle("Portal Calidad | Usuarios"),this.Toast=f().mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:Q=>{Q.addEventListener("mouseenter",f().stopTimer),Q.addEventListener("mouseleave",f().resumeTimer)}})}ngOnInit(){this.activatedRoute.queryParams.subscribe(o=>{o.page?this.page=parseInt(o.page)-1:(this.router.navigate([],{relativeTo:this.activatedRoute,queryParams:{page:"1"}}),this.page=0)}),this._usuariosService.usuarios$.pipe((0,g.R)(this._unsubscribeAll)).subscribe(o=>{this.dataSource=new u.by(o.data),this.totalUsuarios=o.total,this._changeDetectorRef.markForCheck()})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}getUsuariosPaginated(o){this._usuariosService.getUsuariosPaginated(o).pipe((0,g.R)(this._unsubscribeAll)).subscribe(i=>{this._usuariosService.usuarios=i,this.loading=!1,this._changeDetectorRef.markForCheck()},i=>{this.loading=!1,this._changeDetectorRef.markForCheck()})}setUsuarioActive(o){this.loading||(this.loading=!0,this._usuariosService.setActiveUsuario(o).pipe((0,g.R)(this._unsubscribeAll)).subscribe(i=>{this.getUsuariosPaginated(this.page+1)},i=>{this.loading=!1,this._changeDetectorRef.markForCheck(),this.Toast.fire({icon:"error",title:i.error.message})}))}handlePageEvent(o){let i=o.pageIndex+1;this.page=o.pageIndex,this.loading=!0,this.getUsuariosPaginated(i)}abrirDialogoCrearUsuario(){this.loading||this.dialog.open(I,{disableClose:!0,width:"500px",data:{action:"create",title:"Crear usuario"}}).afterClosed().subscribe(i=>{"cancelar"!==i&&this.getUsuariosPaginated(this.page+1)})}abrirDialogoEditarUsuario(o){this.loading||this.dialog.open(I,{disableClose:!0,width:"500px",data:{action:"edit",title:"Editar usuario",usuario:o}}).afterClosed().subscribe(r=>{"cancelar"!==r&&this.getUsuariosPaginated(this.page+1)})}static#t=this.\u0275fac=function(i){return new(i||e)(t.Y36(O.Dx),t.Y36(d.uw),t.Y36(t.sBO),t.Y36(_),t.Y36(J.F0),t.Y36(J.gz))};static#e=this.\u0275cmp=t.Xpm({type:e,selectors:[["app-usuarios"]],standalone:!0,features:[t.jDz],decls:33,vars:8,consts:[["cdkScrollable","",1,"absolute","inset-0","flex","flex-col","min-w-0","overflow-y-auto","bg-white"],[1,"flex-auto","p-6","sm:px-26","sm:py-10"],[1,"min-h-100"],[1,"flex","flex-col","sm:flex-row","sm:justify-between","sm:items-center","items-start","mb-6","w-full","p-4"],[1,"text-4xl","font-semibold","text-primary-700"],["mat-flat-button","",1,"group","border-solid","border-2","rounded-md","border-primary","hover:bg-primary","hover:text-white","text-primary","font-semibold",3,"click"],[3,"svgIcon"],[1,"overflow-x-auto"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","nombre"],["matColumnDef","correo"],["matColumnDef","rol"],["matColumnDef","online"],["matColumnDef","acciones"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"w-full","flex","justify-end"],["aria-label","Seleccionar pagina de usuarios","showFirstLastButtons","true",3,"length","pageSize","pageIndex","disabled","page"],["mat-header-cell",""],["mat-cell",""],["class","text-xs font-semibold rounded-full px-2.5 py-1 bg-green-400","matTooltip","En linea",4,"ngIf"],["class","text-xs font-semibold rounded-full px-2.5 py-1 bg-red-400","matTooltip","Desconectado",4,"ngIf"],["matTooltip","En linea",1,"text-xs","font-semibold","rounded-full","px-2.5","py-1","bg-green-400"],["matTooltip","Desconectado",1,"text-xs","font-semibold","rounded-full","px-2.5","py-1","bg-red-400"],[1,"inline-flex","items-center","me-5","cursor-pointer",3,"matTooltip"],["type","checkbox",1,"sr-only","peer",3,"checked","change"],[1,"relative","w-11","h-6","bg-gray-200","rounded-full","peer","dark:bg-gray-700","peer-focus:ring-4","dark:peer-focus:ring-green-800","peer-checked:after:translate-x-full","rtl:peer-checked:after:-translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-0.5","after:start-[2px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-5","after:w-5","after:transition-all","dark:border-gray-600","peer-checked:bg-green-600"],["mat-icon-button","","color","primary","matTooltip","Editar usuario",1,"hover:bg-gray-200",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(i,r){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),t._uU(5,"Administrador de Usuarios"),t.qZA(),t.TgZ(6,"button",5),t.NdJ("click",function(){return r.abrirDialogoCrearUsuario()}),t._UZ(7,"mat-icon",6),t._uU(8," \xa0 A\xf1adir Usuario "),t.qZA()(),t.TgZ(9,"div",7)(10,"table",8),t.ynx(11,9),t.YNc(12,z,2,0,"th",10)(13,L,2,1,"td",11),t.BQk(),t.ynx(14,12),t.YNc(15,H,2,0,"th",10)(16,G,2,1,"td",11),t.BQk(),t.ynx(17,13),t.YNc(18,K,2,0,"th",10)(19,X,2,1,"td",11),t.BQk(),t.ynx(20,14),t.YNc(21,W,2,0,"th",10)(22,V,2,1,"td",11),t.BQk(),t.ynx(23,15),t.YNc(24,tt,2,0,"th",10)(25,it,3,2,"td",11),t.BQk(),t.ynx(26,16),t.YNc(27,rt,1,0,"th",10)(28,at,6,3,"td",11),t.BQk(),t.YNc(29,st,1,0,"tr",17)(30,nt,1,0,"tr",18),t.qZA()(),t.TgZ(31,"div",19)(32,"mat-paginator",20),t.NdJ("page",function(c){return r.handlePageEvent(c)}),t.qZA()()()()()),2&i&&(t.xp6(7),t.Q6J("svgIcon","heroicons_outline:user"),t.xp6(3),t.Q6J("dataSource",r.dataSource),t.xp6(19),t.Q6J("matHeaderRowDef",r.displayedColumns),t.xp6(),t.Q6J("matRowDefColumns",r.displayedColumns),t.xp6(2),t.Q6J("length",r.totalUsuarios)("pageSize",r.limit)("pageIndex",r.page)("disabled",r.loading))},dependencies:[b.ez,b.O5,p.ot,p.lW,p.RK,U.Ps,U.Hw,u.p0,u.BZ,u.fO,u.as,u.w1,u.Dz,u.nj,u.ge,u.ev,u.XQ,u.Gk,T.TU,T.NW,A.AV,A.gM,j.PQ],encapsulation:2})}return e})(),resolve:{usuarios:(e,a)=>{let o=e.queryParamMap.get("page")||"1";return(0,t.f3M)(_).getAllUsuarios(o)}}}]}}]);