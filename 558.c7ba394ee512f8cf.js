"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[558],{6558:(K,Z,s)=>{s.r(Z),s.d(Z,{default:()=>W});var v=s(6814),p=s(2296),f=s(617),A=s(1476),l=s(5313),_=s(2596),b=s(553),y=s(8645),g=s(9773),I=s(3519),d=s.n(I),a=s(6223),c=s(7700),U=s(8525),D=s(4516),h=s(4170),e=s(9212),x=s(1474),R=s(5619),S=s(9397);let T=(()=>{class i{constructor(){this.url=b.N.url,this.limit=b.N.pagination,this._httpCliente=(0,e.f3M)(x.eN),this._comisiones=new R.X(null)}set comisiones(t){this._comisiones.next(t)}get comisiones$(){return this._comisiones.asObservable()}getAllComisiones(t){let o=new x.LE;return o=o.append("page",t),o=o.append("limit",this.limit),this._httpCliente.get(`${this.url}comisiones/por-usuario`,{params:o}).pipe((0,S.b)(n=>{this._comisiones.next(n)}))}getComisionesPaginated(t){let o=new x.LE;return o=o.append("page",t),o=o.append("limit",this.limit),this._httpCliente.get(`${this.url}comisiones/por-usuario`,{params:o})}createComision(t){return this._httpCliente.post(`${this.url}comisiones`,t)}updateComision(t){return this._httpCliente.patch(`${this.url}comisiones/${t.id}`,t)}static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var j=s(3680);function w(i,r){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," El prefijo es requerido "),e.qZA())}function P(i,r){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," El prefijo no puede contener espacios en blanco. "),e.qZA())}let N=(()=>{class i{constructor(t,o,n,m,u){this.data=t,this.dialogRef=o,this._formBuilder=n,this._changeDetectorRef=m,this._comisionesService=u,this._unsubscribeAll=new y.x,this.title="",this.showData=!1,this.comision={},this.Toast=d().mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:C=>{C.addEventListener("mouseenter",d().stopTimer),C.addEventListener("mouseleave",d().resumeTimer)}})}ngOnInit(){this.title=this.data.title,this.comisionForm=this._formBuilder.group({nombre:["",a.kI.required],descripcion:["",a.kI.required],prefijo:["",[a.kI.required,i=>/\s/.test(i.value)?{noSpaces:!0}:null]],puntuacion:[!1,a.kI.required]}),"edit"===this.data.action&&(this.comision=this.data.comision,this.comisionForm.patchValue(this.data.comision),this.comisionForm.get("prefijo").disable())}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}cerrarDialogo(){this.dialogRef.close("cancelar")}guardarComision(){if(this.comisionForm.invalid)return void this.Toast.fire({icon:"error",title:"Por favor, complete los campos requeridos."});this.comisionForm.disable();let t=this.comisionForm.value;"edit"===this.data.action?(t.id=this.comision.id,this.editarComision(t)):this.crearComision(t)}crearComision(t){this._comisionesService.createComision(t).pipe((0,g.R)(this._unsubscribeAll)).subscribe({next:o=>{this.Toast.fire({icon:"success",title:"Comisi\xf3n creada con \xe9xito."}),this.dialogRef.close("guardar")},error:o=>{this.Toast.fire({icon:"error",title:`Error al crear la comisi\xf3n: ${o.error.message}`}),this.comisionForm.enable()}})}editarComision(t){this._comisionesService.updateComision(t).pipe((0,g.R)(this._unsubscribeAll)).subscribe({next:o=>{this.Toast.fire({icon:"success",title:"Comisi\xf3n actualizada con \xe9xito."}),this.dialogRef.close("guardar")},error:o=>{this.Toast.fire({icon:"error",title:`Error al actualizar la comisi\xf3n: ${o.error.message}`}),this.comisionForm.enable()}})}onBlurTrim(t){const o=this.comisionForm.get(t);o&&o.setValue(o.value.trim())}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(c.WI),e.Y36(c.so),e.Y36(a.qu),e.Y36(e.sBO),e.Y36(T))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-comisiones-modal"]],standalone:!0,features:[e.jDz],decls:44,vars:16,consts:[["mat-dialog-title","",1,"flex","text-primary-600","font-bold","text-3xl"],[1,"w-full"],["autocomplete","false",3,"formGroup"],["supportNgForm","ngForm"],[1,"mb-4"],[1,"text-lg","font-medium"],["id","nombrecomision","type","text","matInput","","required","",3,"formControlName"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["id","descripcioncomision","matInput","","required","",3,"formControlName"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-4"],["id","prefijocomision","type","text","matInput","","required","",3,"formControlName","blur"],[4,"ngIf"],["required","",3,"formControlName"],["disabled","",3,"value"],[3,"value"],[1,"flex","justify-between","mt-4"],["mat-button","",1,"text-black","hover:bg-black","hover:text-white","border-2","rounded-md","border-solid",3,"click"],["mat-flat-button","",1,"text-white","hover:bg-white","hover:text-primary-600","border-2","rounded-md","hover:border-solid",3,"color","click"]],template:function(o,n){1&o&&(e.TgZ(0,"h2",0),e._uU(1),e.qZA(),e.TgZ(2,"mat-dialog-content")(3,"div",1)(4,"form",2,3)(6,"div",4)(7,"mat-form-field",1)(8,"mat-label",5),e._uU(9,"Nombre"),e.qZA(),e._UZ(10,"input",6)(11,"mat-icon",7),e.qZA()(),e.TgZ(12,"div",4)(13,"mat-form-field",1)(14,"mat-label",5),e._uU(15,"Descripci\xf3n"),e.qZA(),e._UZ(16,"textarea",8)(17,"mat-icon",7),e.qZA()(),e.TgZ(18,"div",9)(19,"div")(20,"mat-form-field",1)(21,"mat-label",5),e._uU(22,"Prefijo"),e.qZA(),e.TgZ(23,"input",10),e.NdJ("blur",function(){return n.onBlurTrim("prefijo")}),e.qZA(),e._UZ(24,"mat-icon",7),e.YNc(25,w,2,0,"mat-error",11)(26,P,2,0,"mat-error",11),e.qZA()(),e.TgZ(27,"div")(28,"mat-form-field",1)(29,"mat-label",5),e._uU(30,"Puntuaci\xf3n"),e.qZA(),e.TgZ(31,"mat-select",12)(32,"mat-option",13),e._uU(33," Seleccionar Puntuaci\xf3n "),e.qZA(),e.TgZ(34,"mat-option",14),e._uU(35," Si "),e.qZA(),e.TgZ(36,"mat-option",14),e._uU(37," No "),e.qZA()(),e._UZ(38,"mat-icon",7),e.qZA()()()()()(),e.TgZ(39,"mat-dialog-actions",15)(40,"button",16),e.NdJ("click",function(){return n.cerrarDialogo()}),e._uU(41,"Cancelar"),e.qZA(),e.TgZ(42,"button",17),e.NdJ("click",function(){return n.guardarComision()}),e._uU(43,"Guardar"),e.qZA()()),2&o&&(e.xp6(),e.Oqu(n.title),e.xp6(3),e.Q6J("formGroup",n.comisionForm),e.xp6(6),e.Q6J("formControlName","nombre"),e.xp6(),e.Q6J("svgIcon","mat_outline:person_outline"),e.xp6(5),e.Q6J("formControlName","descripcion"),e.xp6(),e.Q6J("svgIcon","mat_outline:person_outline"),e.xp6(6),e.Q6J("formControlName","prefijo"),e.xp6(),e.Q6J("svgIcon","mat_outline:person_outline"),e.xp6(),e.Q6J("ngIf",n.comisionForm.get("prefijo").hasError("required")),e.xp6(),e.Q6J("ngIf",n.comisionForm.get("prefijo").hasError("noSpaces")),e.xp6(5),e.Q6J("formControlName","puntuacion"),e.xp6(),e.Q6J("value",""),e.xp6(2),e.Q6J("value",!0),e.xp6(2),e.Q6J("value",!1),e.xp6(2),e.Q6J("svgIcon","heroicons_solid:users"),e.xp6(4),e.Q6J("color","primary"))},dependencies:[v.ez,v.O5,c.Is,c.uh,c.H8,c.xY,p.ot,p.lW,f.Ps,f.Hw,a.u5,a._Y,a.Fj,a.JJ,a.JL,a.Q7,h.lN,h.KE,h.hX,h.TO,h.qo,a.UX,a.sg,a.u,D.c,D.Nt,U.LD,U.gD,j.ey],encapsulation:2})}return i})();var q=s(6593),F=s(8109),Y=s(5407);function E(i,r){1&i&&(e.TgZ(0,"th",20),e._uU(1," Id "),e.qZA())}function B(i,r){if(1&i&&(e.TgZ(0,"td",21),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(),e.hij(" ",t.id," ")}}function $(i,r){1&i&&(e.TgZ(0,"th",20),e._uU(1," Nombre "),e.qZA())}function O(i,r){if(1&i&&(e.TgZ(0,"td",21),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(),e.hij(" ",t.nombre,"")}}function k(i,r){1&i&&(e.TgZ(0,"th",20),e._uU(1," Prefijo "),e.qZA())}function z(i,r){if(1&i&&(e.TgZ(0,"td",21),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(),e.hij(" ",t.prefijo," ")}}function M(i,r){1&i&&(e.TgZ(0,"th",20),e._uU(1," Puntuaci\xf3n "),e.qZA())}function L(i,r){if(1&i&&(e.TgZ(0,"td",21),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(),e.hij(" ",t.puntuacion?"Si":"No"," ")}}function H(i,r){1&i&&e._UZ(0,"th",20)}function X(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"td",21)(1,"button",22),e.NdJ("click",function(){const m=e.CHM(t).$implicit,u=e.oxw();return e.KtG(u.abrirDialogoEditarComision(m))}),e._UZ(2,"mat-icon",6),e.qZA()()}2&i&&(e.xp6(2),e.Q6J("svgIcon","heroicons_outline:pencil"))}function G(i,r){1&i&&e._UZ(0,"tr",23)}function V(i,r){1&i&&e._UZ(0,"tr",24)}const W=[{path:"",component:(()=>{class i{constructor(t,o,n,m,u,C){this.titleService=t,this.dialog=o,this._changeDetectorRef=n,this._comisionesService=m,this.router=u,this.activatedRoute=C,this._unsubscribeAll=new y.x,this.displayedColumns=["id","nombre","prefijo","puntuacion","acciones"],this.dataSource=new l.by([]),this.totalComisiones=0,this.page=0,this.limit=b.N.pagination,this.loading=!1,this.titleService.setTitle("Portal Calidad | Comisiones"),this.Toast=d().mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:J=>{J.addEventListener("mouseenter",d().stopTimer),J.addEventListener("mouseleave",d().resumeTimer)}})}ngOnInit(){this.activatedRoute.queryParams.subscribe(t=>{t.page?this.page=parseInt(t.page)-1:(this.router.navigate([],{relativeTo:this.activatedRoute,queryParams:{page:"1"}}),this.page=0)}),this._comisionesService.comisiones$.pipe((0,g.R)(this._unsubscribeAll)).subscribe(t=>{this.dataSource=new l.by(t.comisiones),this.totalComisiones=t.total,this._changeDetectorRef.markForCheck()})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}getComisionesPaginated(t){this._comisionesService.getComisionesPaginated(t).pipe((0,g.R)(this._unsubscribeAll)).subscribe({next:o=>{this._comisionesService.comisiones=o,this.loading=!1,this._changeDetectorRef.markForCheck()},error:o=>{this.loading=!1,this._changeDetectorRef.markForCheck()}})}abrirDialogoCrearComision(){this.loading||this.dialog.open(N,{disableClose:!0,width:"600px",data:{action:"create",title:"Crear Comisi\xf3n"}}).afterClosed().subscribe(o=>{"cancelar"!==o&&this.getComisionesPaginated(this.page+1)})}abrirDialogoEditarComision(t){this.loading||this.dialog.open(N,{disableClose:!0,width:"600px",data:{action:"edit",title:"Editar Comisi\xf3n",comision:t}}).afterClosed().subscribe(n=>{"cancelar"!==n&&this.getComisionesPaginated(this.page+1)})}handlePageEvent(t){let o=t.pageIndex+1;this.page=t.pageIndex,this.loading=!0,this.getComisionesPaginated(o)}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(q.Dx),e.Y36(c.uw),e.Y36(e.sBO),e.Y36(T),e.Y36(F.F0),e.Y36(F.gz))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-comisiones"]],standalone:!0,features:[e.jDz],decls:30,vars:8,consts:[["cdkScrollable","",1,"absolute","inset-0","flex","flex-col","min-w-0","overflow-y-auto","bg-white"],[1,"flex-auto","p-6","sm:px-26","sm:py-10"],[1,"min-h-100"],[1,"flex","flex-col","sm:flex-row","sm:justify-between","sm:items-center","items-start","mb-6","w-full","p-4"],[1,"text-4xl","font-semibold","text-primary-700"],["mat-flat-button","",1,"group","border-solid","border-2","rounded-md","border-primary","hover:bg-primary","hover:text-white","text-primary","font-semibold",3,"click"],[3,"svgIcon"],[1,"overflow-x-auto"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","nombre"],["matColumnDef","prefijo"],["matColumnDef","puntuacion"],["matColumnDef","acciones"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"w-full","flex","justify-end"],["aria-label","Seleccionar pagina de comisiones","showFirstLastButtons","true",3,"length","pageSize","pageIndex","disabled","page"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","color","primary","matTooltip","Editar Comisi\xf3n",1,"hover:bg-gray-200",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(o,n){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),e._uU(5,"Administrador de Comisiones."),e.qZA(),e.TgZ(6,"button",5),e.NdJ("click",function(){return n.abrirDialogoCrearComision()}),e._UZ(7,"mat-icon",6),e._uU(8," \xa0 A\xf1adir Comisi\xf3n "),e.qZA()(),e.TgZ(9,"div",7)(10,"table",8),e.ynx(11,9),e.YNc(12,E,2,0,"th",10)(13,B,2,1,"td",11),e.BQk(),e.ynx(14,12),e.YNc(15,$,2,0,"th",10)(16,O,2,1,"td",11),e.BQk(),e.ynx(17,13),e.YNc(18,k,2,0,"th",10)(19,z,2,1,"td",11),e.BQk(),e.ynx(20,14),e.YNc(21,M,2,0,"th",10)(22,L,2,1,"td",11),e.BQk(),e.ynx(23,15),e.YNc(24,H,1,0,"th",10)(25,X,3,1,"td",11),e.BQk(),e.YNc(26,G,1,0,"tr",16)(27,V,1,0,"tr",17),e.qZA()(),e.TgZ(28,"div",18)(29,"mat-paginator",19),e.NdJ("page",function(u){return n.handlePageEvent(u)}),e.qZA()()()()()),2&o&&(e.xp6(7),e.Q6J("svgIcon","heroicons_outline:folder"),e.xp6(3),e.Q6J("dataSource",n.dataSource),e.xp6(16),e.Q6J("matHeaderRowDef",n.displayedColumns),e.xp6(),e.Q6J("matRowDefColumns",n.displayedColumns),e.xp6(2),e.Q6J("length",n.totalComisiones)("pageSize",n.limit)("pageIndex",n.page)("disabled",n.loading))},dependencies:[v.ez,p.ot,p.lW,p.RK,f.Ps,f.Hw,l.p0,l.BZ,l.fO,l.as,l.w1,l.Dz,l.nj,l.ge,l.ev,l.XQ,l.Gk,A.TU,A.NW,_.AV,_.gM,Y.PQ],encapsulation:2})}return i})(),resolve:{comisiones:(i,r)=>{let t=i.queryParamMap.get("page")||"1";return(0,e.f3M)(T).getAllComisiones(t)}}}]}}]);